# 甘特图节假日功能说明

## 功能概述

本项目增强了甘特图时间轴的显示功能，支持：

1. **周六特殊显示** - 蓝色高亮
2. **周日特殊显示** - 红色高亮
3. **节假日动态显示** - 金色高亮，并显示节假日名称
4. **组合样式** - 支持多种状态组合（如：今天+周六、节假日+今天等）

## 功能实现

### 1. 时间轴样式增强

- **周六样式** - 蓝色背景 (`rgba(59, 130, 246, 0.12)`)，蓝色文字 (`#2563eb`)
- **周日样式** - 红色背景 (`rgba(239, 68, 68, 0.12)`)，红色文字 (`#dc2626`)
- **节假日样式** - 金色背景 (`rgba(245, 158, 11, 0.15)`)，橙色文字 (`#d97706`)，显示 🎉 图标
- **今天样式** - 保持原有蓝色边框样式
- **月初样式** - 保持原有蓝色标记

### 2. 节假日数据服务

#### API 支持

- **主 API**: `https://api.apihubs.cn/holiday/get?field=workday,holiday&year={year}`
- **备用 API**: `https://timor.tech/api/holiday/year/{year}`
- **本地兜底**: 当 API 失败时使用内置的中国节假日数据

#### 缓存机制

- 按年份缓存节假日数据
- 缓存有效期：24 小时
- 避免重复请求同一年份数据
- 支持手动清除缓存

#### 预加载策略

- 根据甘特图显示的日期范围自动预加载对应年份的节假日数据
- 并行请求多个年份，提高加载效率
- 数据加载完成后自动刷新时间轴显示

## 使用方法

### 1. 访问测试页面

项目启动后，访问 `http://localhost:8080/holiday-test` 进行功能测试。

测试页面包含：

- 节假日服务 API 测试
- 时间轴样式预览
- 甘特图实际效果演示

### 2. 在甘特图中使用

节假日功能已集成到 `GanttTimeline` 组件中，无需额外配置。

```vue
<GanttTimeline
  :view-mode="viewMode"
  :start-date="startDate"
  :end-date="endDate"
  :zoom-level="zoomLevel"
  :pan-offset="panOffset"
  :container-width="containerWidth"
/>
```

### 3. API 配置

如需更换节假日 API，修改 `src/services/holidayService.js` 中的 API 地址：

```javascript
// 主API
const apiUrl = `https://your-api.com/holidays/${year}`;

// 备用API
const backupUrl = `https://backup-api.com/holidays/${year}`;
```

## 样式优先级

样式应用遵循以下优先级（从高到低）：

1. **节假日** - 优先级最高，金色显示
2. **今天** - 蓝色边框高亮
3. **周六** - 蓝色背景
4. **周日** - 红色背景
5. **月初** - 蓝色标记
6. **普通日期** - 默认样式

### 组合样式

当多种状态同时存在时，会应用渐变组合样式：

- **节假日+今天** - 金色到蓝色渐变 + 双边框
- **节假日+周六** - 金色到蓝色渐变
- **节假日+周日** - 金色到红色渐变
- **今天+周六** - 蓝色渐变 + 边框
- **今天+周日** - 蓝色到红色渐变 + 边框

## 悬停效果

所有特殊日期都有增强的悬停效果：

- 颜色加深
- 轻微上移 (`translateY(-1px)`)
- 添加投影效果

## 提示信息

时间轴单元格支持鼠标悬停显示详细信息：

- 日期
- 类型（Saturday/Sunday/Holiday）
- 节假日名称（如适用）
- 特殊标记（Today/Month Start）

## 性能优化

### 1. 数据缓存

- 节假日数据按年份缓存，避免重复请求
- 智能预加载，只加载显示范围内的年份数据

### 2. 渲染优化

- 样式计算在数据预处理阶段完成
- CSS 使用高效的伪元素实现复杂效果
- GPU 加速的过渡动画

### 3. 错误处理

- API 失败时自动降级到本地数据
- 超时控制防止页面阻塞
- 用户友好的错误提示

## 技术细节

### 文件结构

```
src/
├── services/
│   └── holidayService.js       # 节假日数据服务
├── components/
│   └── GanttTimeline.vue       # 增强的时间轴组件
└── views/
    └── HolidayTestView.vue     # 功能测试页面
```

### 依赖

- `moment.js` - 日期处理
- `fetch API` - HTTP 请求
- `AbortController` - 请求超时控制

### 浏览器兼容性

- 现代浏览器 (Chrome 66+, Firefox 57+, Safari 12.1+)
- 支持 `fetch` 和 `AbortController` API

## 故障排除

### 1. 节假日数据不显示

- 检查网络连接
- 查看浏览器控制台是否有 API 错误
- 访问测试页面验证服务状态

### 2. 样式不正确

- 确认 CSS 文件正确加载
- 检查是否有样式覆盖冲突
- 查看时间轴组件的 class 应用

### 3. 性能问题

- 检查是否在短时间内多次切换日期范围
- 查看控制台是否有重复的 API 请求
- 考虑减少显示的日期范围

## 未来扩展

1. **多国节假日支持** - 支持不同国家的节假日 API
2. **自定义节假日** - 允许用户添加自定义节假日
3. **工作日调整** - 支持调休等特殊工作日安排
4. **主题定制** - 允许自定义周末和节假日的颜色主题
5. **节假日详情** - 显示更详细的节假日信息
